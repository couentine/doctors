<% 
  log_url = URI::escape(@log.evidence_url(@group, @badge, @user)) 
  twitter_url = "http://twitter.com/intent/tweet?original_referer=http://badgelist.com" \
    + "&related=BadgeList&url=#{log_url}"
  facebook_url = "https://www.facebook.com/sharer/sharer.php?u=#{log_url}"
  linkedin_url = @log.evidence_url(@group, @badge, @user)
  embed_url = @log.embed_url(@group, @badge, @user)
%>

<script type="text/javascript">
  
  $(document).ready(function() {

    var assertionURL = "<%= @log.assertion_url(@group, @badge, @user) %>";

    $('#export-to-backpack').click(function() {
      $('#badge-sharing').modal('hide');
      OpenBadges.issue([assertionURL], function(errors, successes) {
        if ((errors != null) && (errors.length > 0) && (errors[0].reason != 'DENIED')) {
          $('#badge-sharing-error').modal('show');
          $('#badge-sharing-error-text').html("Assertion URL = " + errors[0].url 
            + ", Reason = " + errors[0].reason);
        }
      });
    });

    $('#export-to-embed').click(function() {
      $('#badge-sharing').modal('hide');
      $('#badge-embed').modal('show');
    });

    $('#export-to-linkedin').click(function() {
      $('#badge-sharing').modal('hide');
      $('#add-to-linkedin').modal('show');
    });

  });

</script>

<div id="badge-sharing" class="modal hide fade" tabindex="-1" role="dialog" 
 aria-labelledby="mimm-label" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="mimm-label">Share your badge achievement</h3>
  </div>

  <div class="modal-body">
    <ul class="button-list">
      <li>
        <a href="#" id="export-to-linkedin" class="btn btn-large btn-primary">
          <i class="fa fa-linkedin-square"></i>
          Add to LinkedIn Profile
        </a>
      </li>
      <li>
        <a href="<%= facebook_url %>" target="_blank" id="export-to-facebook" 
            class="btn btn-large btn-primary">
          <i class="fa fa-facebook-square"></i>
          Post to Facebook
        </a>
      </li>
      <li>
        
        <a href="<%= twitter_url %>" target="_blank" id="export-to-twitter" 
            class="btn btn-large btn-primary">
          <i class="fa fa-twitter-square"></i>
          Share on Twitter
        </a>
      </li>
      <li>
        <a href="#" id="export-to-backpack" class="btn btn-large btn-warning">
          <i class="fa fa-cloud-upload"></i>
          Add to Mozilla Backpack
        </a>
      </li>
      <li>
        <a href="#" id="export-to-embed" class="btn btn-large btn-success">
          <i class="fa fa-code"></i>
          Get HTML embed code
        </a>
      </li>
    </ul>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<!-- === ADD TO LINKEDIN MODAL === -->

<div id="add-to-linkedin" class="modal hide fade" tabindex="-1" role="dialog" 
 aria-labelledby="mimm-label" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="mimm-label">Add badge to LinkedIn</h3>
  </div>

  <div class="modal-body">
    <p>
      Follow the steps below to display your badge achievement on your LinkedIn profile.
    </p>
    <ol class="number-list">
      <li>
        Copy this URL to your clipboard:<br>
        <input type="text" class="embed-code"
        value="<%= linkedin_url %>"/>
      </li>
      <li>
        <a class="btn" href="https://www.linkedin.com/profile/edit" target="_blank">
          <i class="fa fa-linkedin-square"></i> Edit your LinkedIn profile
        </a>
      </li>
      <li>
        Click the <em>Add Media: Link</em> button at the bottom of one of the Summary or 
        Experience sections and paste the URL. Then click <em>Continue</em>, then
        <em>Add to Profile</em>.
      </li>
    </ol>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<!-- === BADGE EMBED MODAL === -->

<div id="badge-embed" class="modal hide fade" tabindex="-1" role="dialog" 
 aria-labelledby="mimm-label" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="mimm-label">Badge embed code</h3>
  </div>

  <div class="modal-body">
    <p>
      You can display your badge achievement on your blog or on any other website which supports 
      iframes. Just copy and paste the code below.
    </p>
    <input type="text" class="embed-code"
      value='<iframe src="<%= embed_url %>" width="100%" height="525" frameborder="0"></iframe>'/>
    <p class="small">
      (<a href="<%= embed_url %>" target="_blank">Click here to see what it will look like.</a>)
    </p>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>

<!-- === BADGE SHARING ERROR MODAL === -->

<div id="badge-sharing-error" class="modal hide fade" tabindex="-1" role="dialog" 
 aria-labelledby="mimm-label" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="mimm-label">Oh no!</h3>
  </div>

  <div class="modal-body">
    <p>
      It looks like there was an error sharing your badge. This could be due to a problem with
      Mozilla's system or it could be due to a bug in Badge List. We humbly apologize for the 
      inconvenience and ask you to try again later.
    </p>
    <p>
      In the meantime please feel free to send an email to <b>help@badgelist.com</b> if you'd 
      like our help resolving this issue. (Be sure to include the error text below.) Thanks!
    </p>
    <p>
      <b>Error Text:</b> 
      <span id="badge-sharing-error-text"></span>
    </p>
  </div>

  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
  </div>
</div>