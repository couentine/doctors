<% 
  if @current_user_can_see_profile
    provide(:title, @name)
  else
    provide(:title, 'Private Profile')
  end
%>

<% #=== IF THIS IS A PRIVATE USER THEN WE WILL CONCEAL THE ENTIRE PROFILE IF NEEDED ===# %>
<% if @current_user_can_see_profile %>

  <div class="row add-top-margin">
    <div class="span12">
      <div class="header-card user-header-card">

        <div class="primary-header span12">
          <span class="header-image"> 
            <%= image_tag @avatar_image_url, class: 'img-circle' %>
            <% if @this_is_current_user %>
              <div class="btn-overlay hidden-until-hover">
                <%= link_to "<i class='fa fa-pencil'></i> Edit image".html_safe,
                  edit_user_registration_path + '#upload-image', class: 'btn btn-small' %>  
              </div>
            <% end %>
          </span>
          <span class="header-text">
            <h1>
              <%= @name %>
              
              <% if @domain.present? && @current_user_can_see_domain %>
                <a href="<%= domain_path(@domain) %>" class="no-hover">
                  <span class="label" title="<%= @domain_tooltip %>" data-toggle="tooltip" 
                      data-placement="bottom">
                    <i class="fa <%= @domain_label_icon %>"></i> <%= @domain_label_text %>
                  </span>
                </a>
              <% end %>
            </h1>
            <h2>
              Unclaimed Profile
            </h2>
          </span>
        </div>

      </div>
    </div>
  </div>

  <!-- === AWARDED BADGES === -->

  <% if @group_badge_list.blank? %>

    <div class="row">
      <div class="well span7 offset2">
        <h3>No badges yet...</h3>
        <p>
          This user hasn't earned any badges yet.
        </p>
      </div>
    </div>

  <% else %>

    <div class="row">
      <div class="span12">
        <div class="container-card evidence-card">
          <%
            @group_badge_list.each do |group_row| 
              group = group_row[:group]
          %>
              
            <table class="header-table">
              <tr>
                <td>
                  <%= link_to image_tag(group.avatar_image_url(:medium)), group, title: "View the group", class: "image-link" %>
                </td>
                <td>
                  <h2><%= link_to group.name, group, title: "View the group" %></h2>
                </td>
              </tr>
            </table>

            <div class="body-row">
              <% group_row[:badges].each do |badge| %>

                <div class="inner-row">
                  <%= link_to image_tag(badge.image_url(:medium)), "/#{group.to_param}/#{badge.to_param}/u/#{@user_key}", 
                    title: "View the badge", class: "image-link" %>

                  <h2>
                    <%= link_to badge.name, "/#{group.to_param}/#{badge.to_param}/u/#{@user_key}" %>
                  </h2>
                </div>

              <% end %> <!-- === # END: badges.each === -->
            </div>

          <% end %> <!-- === # END: @group_badge_list.each === -->
        </div>
      </div>
    </div>

  <% end %>

  <% if !@groups.blank? %>
    
    <!-- === GROUP MEMBERSHIPS === -->

    <div class="row">
      <div class="span12">
        <div class="tab-header merge-with-card">
          <h2>Group Memberships</h2>
        </div>
      </div>
    </div>

    <div class="row" id="topic-list-row">
      <div class="span12">
        <div class="info-card text-card group-list-card">
          <ul>
            <% @groups.each do |group| %>
              <li>
                <%= link_to image_tag(group.avatar_image_url(:small)) + " " + group.name, group, 
                  title: "View the group" %>
              </li>
            <% end %>
          </ul>
        </div>
      </div>
    </div>

  <% end %>

<% else %>
  
  <div class="row add-top-margin">
    <div class="well span7 offset2">
      <h3>This is a private user profile</h3>
      <p>
        This Badge List user is part of a private domain. 
        You must be a member of their domain in order to see their profile.
      </p>
    </div>
  </div>

<% end %>