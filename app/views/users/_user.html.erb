<%
  # Object Variables = group
  # Boolan Variables = is_admin, show_email
%>

<div class="info-card user-card fixed-height" data-bl-dyncol="child">
  <table>
    <tr class="card-body-row">
      <td class="card-image" style="background-image: url('<%= gravatar_url_for user, :size => 150 %>')">
        <%= link_to '&nbsp;'.html_safe, user, title: "View user profile", 
            class: 'image-link' %>
      </td>
      <td class="card-body">
        <span class="card-headline">
          <span class="card-actions">
            <%=
              # Output the little "X" that allows admins to remove users from groups
              if is_admin && group && (current_user != user) && (user.id != group.owner_id)
                if user.admin_of?(group)
                  path = destroy_group_admin_path(group, user) 
                  link_title = "Downgrade this admin to a member"
                  link_confirm = "Are you sure you want to downgrade this admin to a normal member?"
                elsif user.member_of?(group)
                  path = destroy_group_member_path(group, user)
                  link_title = "Remove this member"
                  link_confirm = \
                    "Are you absolutely sure you want to revoke this user's membership?"
                else
                  path = nil
                  link_title = nil
                end

                if path
                  link_to '<i class="icon-remove"></i>'.html_safe, path,
                          method: :delete, class: "user-card-delete", title: link_title,
                          data: { toggle: "tooltip", placement: "bottom", confirm: link_confirm }
                end
              end 
            %>
          </span>

          <h2><%= link_to user.name, user, title: "View user profile" %></h2>
          <% if show_email %>
            <h3><%= user.email %></h3>
          <% else %>
            <h3><%= user.username %></h3>
          <% end %>
        </span>
        <span class="card-footline">
          Joined <%= user.created_at.to_s(:full_date) %>
        </span>
      </td>
    </tr>
  </table>
</div>