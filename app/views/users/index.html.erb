<% 
  provide(:title, "All Users")
%>

<style type="text/css">
  
  a.label {
    color: white !important;
  }
  a.label:hover, a.label:focus {
    background-color: #333;
  }

</style>

<script type="text/javascript">

  var userSearchURL = '<%= users_url(search: '__search__') %>';
  
  $(document).ready(function() {

    $('#search-users').click(function(e) {
      e.preventDefault();

      var userSearch = prompt('Enter text to search email, username and name:');
      if ((userSearch != null) && (userSearch != undefined))
        document.location.href = userSearchURL.replace('__search__', userSearch);
    });

  });

</script>

<!-- === PAGE HEADER === -->

<div class="row add-top-margin">
  <div class="span12">
    <div class="header-card admin-header-card">
      <div class="white-background no-tabs">&nbsp;</div>

      <div class="primary-header span6">
        <span class="header-image" >
          <i class="fa fa-user"></i>
        </span>
        <span class="header-text">
          <h1>Badge List Users</h1>
          <h2>Admin Tools</h2>
        </span>
      </div>

      <div class="secondary-header span6">
        <span class="header-text">
          <h2>
            Showing <%= ((@page.to_i - 1) * @page_size.to_i) + 1 %>
            - <%= [(@page.to_i * @page_size.to_i), @users.count].min %>
            of <%= @users.count %>
          </h2>
          <h3>
            <% if @search.present? %>
                Showing Search Results for '<%= @search %>'
                <%= link_to 'Clear search', users_path, class: 'btn btn-small' %>
            <% else %>
              <a id="search-users" href="#" class="btn btn-small">
                <i class="fa fa-search"></i> Search for Users
              </a>
            <% end %>

            <%= link_to "<i class='fa fa-plus'></i> New User".html_safe, new_user_path, 
              class: 'btn btn-small' %>
          </h3>
        </span>            
      </div>
    </div>
  </div>
</div>

<div class="row add-top-margin">
  <div class="span12">

  </div>
</div>

<!-- === USERS LIST === -->

<% if !@users.blank? %>
  
  <div class="row">
    <div class="span12">
      <div class="pagination-header">
        <div class="pagination"><%= paginate @users %></div>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="span12">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>User</th>
              <th>Email</th>
              <th>Join, Logins</th>
              <th>Last Active</th>
              <th>Groups Owned</th>
              <th>Memberships</th>
              <th>Entries</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <tr>
                <td>
                  <%= image_tag user.avatar_image_url(:small), class: 'img-circle', size: '20x20' %>
                  <a href="<%= user_path(user) %>">
                    <%= user.name %>
                  </a>
                </td>
                <td>
                  <%= user.email %>
                </td>
                <td>
                  <%= user.created_at.to_s :short_date %>, <%= user.sign_in_count %>
                </td>
                <td>
                  <%= user.last_active.to_s unless user.last_active.nil? %>
                </td>
                <td>
                  <%= (user.owned_group_ids || []).count %>
                </td>
                <td>
                  <%= (user.admin_of_ids || []).count + (user.member_of_ids || []).count  %>
                </td>
                <td>
                  <%= (user.created_entry_ids || []).count %>
                </td>
                <td>
                  <% if !user.admin %>
                    <%= link_to 'Edit', edit_user_path(user), class: 'btn btn-small' %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
    </div>
  </div>

  <div class="row">
    <div class="span12">
      <div class="pagination-footer">
        <div class="pagination"><%= paginate @users %></div>
      </div>
    </div>
  </div>

<% end %>