<%
  # Object Variables: entry, log, badge, group, user
  # ALTERNATE Map[entry_id] Variables: log_map, user_map >> You can set these instead of log & user 
  # OPTIONS:
  #   date_format >> How is the date displayed? >> options = :full, :ago, :learner_week 
  #                  default = :full

  date_format ||= :full
  log = log_map[entry.id] if log.nil?
  user = user_map[entry.id] if user.nil?

  if log.validation_status == 'validated'
    log_user_type = 'expert'
  else
    log_user_type = 'learner'
  end
%>


<% if log && badge && group %>

  <div class="info-card entry-card <%= entry.type %> <%= entry.format %>" 
    data-bl-dyncol="child">

    <div class="card-headline-row">
      <% if !entry.linkified_summary.blank? %>
        <h2><%= entry.linkified_summary.html_safe %></h2>
      <% elsif !entry.summary.blank? %>
        <h2><%= entry.summary %></h2>
      <% else %>
        <h2 class="empty">Posted Image</h2>
      <% end %>

      <span class='header-action'>
        <%= link_to "<i class='fa fa-chevron-circle-right'></i>".html_safe, 
          "/#{group.to_param}/#{badge.to_param}/u/#{user.username}/#{entry.to_param}" %>
      </span>
    </div>

    <div class="card-body-row">
      <div class="card-body-inner" data-mark-overflow="true">
        <!-- === ENTRY CONTENT PARTIAL === -->
        <%= render "shared/entry_content_small", entry: entry, log: log, badge: badge, user: user, 
          group: group %>
      </div>
      
      <div class="card-footline-row">      
        <span class="log-gravatar">
          <%= link_to gravatar_for(user, class: "img-circle #{log_user_type}"), 
            "/#{group.to_param}/#{badge.to_param}/u/#{user.username}",
            title: "View #{user.name}'s #{badge.progress_log}", data: { toggle: 'tooltip' } %>
          <abbr class="username <%= log_user_type %>" data-toggle="tooltip" 
            data-placement="bottom" title="<%= user.name %>" >
            <%= user.username %>
          </abbr>
        </span>
        
        <% if entry.creator_id != log.user_id %>
          <span class="creator-gravatar">
            <img src="<%= gravatar_url_for entry.creator %>" 
              class="gravatar img-circle <%= log_user_type %>"
              title="Posted by <%= entry.current_username %>"
              data-placement="bottom" data-toggle="tooltip">
            
            <% if (entry.type == 'validation') && entry.log_validated %>
              <span class="validation-result positive" title="Feedback includes endorsement"
                data-toggle="tooltip">
                <i class="fa fa-check-circle"></i>
              </span>
            <% elsif (entry.type == 'validation') && !entry.log_validated %>
              <span class="validation-result" data-toggle="tooltip">
                <i class="fa fa-arrow-right"></i>
              </span>
            <% else %>
              <span class="arrow">&#9654;</span>
            <% end %>
          </span>
        <% end %>

        <span class="left-foot">
          <% if date_format == :ago %>
            <% if entry.updated_at <= Time.now %>
              <%= "#{time_ago_in_words(entry.updated_at).capitalize} ago" %>
            <% else %>
              <%= "#{time_ago_in_words(entry.updated_at).capitalize} from now" %>
            <% end %>
          <% else %>
            <%= entry.updated_at.to_s(:full_date_time) %>
          <% end %>
        </span>
      </div>
    </div>

  </div>
    
<% end %>
