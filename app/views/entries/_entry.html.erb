<%
  # OPTIONS:
  #   date_format >> How is the date displayed? >> options = :full, :ago, :learner_week >> default = :full

  date_format ||= :full

  # Force preload of important variables
  entry.log.reload if entry.log.badge.nil?
  entry.log.badge.reload if !entry.log.badge.nil? && entry.log.badge.group.nil?
  entry.log.badge.group.reload if !entry.log.badge.nil? && !entry.log.badge.group.nil?
%>


<% if !entry.log.nil? && !entry.log.badge.nil? && !entry.log.badge.group.nil? %>

  <div class="info-card entry-card <%= entry.category %> <%= entry.format %>" 
    data-bl-dyncol="child">

    <div class="card-headline-row">
      <% if !entry.linkified_summary.blank? %>
        <h2><%= entry.linkified_summary.html_safe %></h2>
      <% elsif !entry.summary.blank? %>
        <h2><%= entry.summary %></h2>
      <% else %>
        <h2 class="empty">Posted Image</h2>
      <% end %>

      <span class='header-action'>
        <%= link_to "<i class='fa fa-chevron-circle-right'></i>".html_safe, 
          [entry.log.badge.group, entry.log.badge, entry.log, entry] %>
      </span>
    </div>

    <div class="card-body-row">
      <div class="card-body-inner" data-mark-overflow="true">
        <!-- === ENTRY CONTENT PARTIAL === -->
        <%= render "shared/entry_content_small", entry: entry %>
      </div>
      
      <div class="card-footline-row">      
        <span class="log-gravatar">
          <%= link_to gravatar_for(entry.log.user, class: "img-circle #{entry.log_user_type}"), 
            [entry.log.badge.group, entry.log.badge, entry.log],
            title: "View #{entry.log.user.name}'s #{entry.log.badge.progress_log}", data: { toggle: 'tooltip' } %>
          <abbr class="username <%= entry.log_user_type %>" data-toggle="tooltip" data-placement="bottom"
            title="<%= entry.log.user.name %>" >
            <%= entry.log.user.username %>
          </abbr>
        </span>
        
        <% if entry.creator != entry.log.user %>
          <span class="creator-gravatar">
            <img src="<%= gravatar_url_for entry.creator %>" 
              class="gravatar img-circle <%= entry.entry_creator_type %>"
              title="Posted by <%= entry.creator.name %>" data-placement="bottom"
              data-toggle="tooltip">
            
            <% if (entry.type == 'validation') && entry.log_validated %>
              <span class="validation-result positive" title="Learning was positively validated"
                data-toggle="tooltip">
                &#10003;
              </span>
            <% elsif (entry.type == 'validation') && !entry.log_validated %>
              <span class="validation-result negative" title="Learning was negatively validated"
                data-toggle="tooltip">
                &#10007;
              </span>
            <% else %>
              <span class="arrow">&#9654;</span>
            <% end %>
          </span>
        <% end %>

        <span class="left-foot">
          <% if date_format == :ago %>
            <% if entry.updated_at <= Time.now %>
              <%= "#{time_ago_in_words(entry.updated_at).capitalize} ago" %>
            <% else %>
              <%= "#{time_ago_in_words(entry.updated_at).capitalize} from now" %>
            <% end %>
          <% elsif date_format == :learner_week %>
            <%= "Week #{entry.learner_week_updated_at}" %> / 
          <% else %>
            <%= entry.updated_at.to_s(:full_date_time) %>
          <% end %>
        </span>
      </div>
    </div>

  </div>
    
<% end %>
