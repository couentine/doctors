<script>

  $(document).ready(function() {
    <% if @group.new_record? %>
      // If this is a new record then auto set the URL as they type
      $('#group_name').keyup(function() {
        $('#group_url_with_caps').val(parameterizeText($(this).val()));
      });
    <% end %>
  });

  function toggleExtraInfo() {
    if ($('#form-extra-info').is(':visible')) {
      $('#form-extra-info').slideUp();
      $('#form-extra-info-toggle').val('Show Extra Info')
      $('#group_name').focus()
    } else {
      $('#form-extra-info').slideDown();
      $('#form-extra-info-toggle').val('Hide Extra Info')
      $('#group_location').focus()
    }
  }

  // Converts "Test text like  this" > "Text-text-like-this"
  var MAX_URL_LENGTH = <%= Group::MAX_URL_LENGTH %>;
  function parameterizeText(s) {
    if (s == null) return '';
    else return s.replace(/['.]/g, '').replace(/[^ A-Za-z0-9]/g, ' ').replace(/ +/g, ' ')
      .replace(/ /g, '-').trunc(MAX_URL_LENGTH);
  }

</script>

<%= simple_form_for(@group, html: { class: 'form-horizontal' }) do |f| %>
  <%= f.error_notification %>
  <div class="form-body">
    <%= f.input :name, label: 'Group Name', placeholder: 'NASA Astronaut Training',
      autofocus: true, input_html: { class: 'input-xlarge', data: { toggle: 'tooltip',
        title: 'What is your organization, team or group called?' } } %>
    
    <%= f.input :url_with_caps, wrapper: :prepend, label: 'Group URL' do %>
      <%= content_tag :span, "badgelist.com/", class: "add-on" %>
      <%= f.input_field :url_with_caps, placeholder: 'nasa-crew', class: 'input-medium', 
        data: { toggle: 'tooltip',
        title: 'Pick a unique URL for your learning group' } %>
    <% end %>

    <%= f.input :type, label: 'Group Type', as: :radio_buttons, label_html: { class: 'hidden' },
                collection: @group_type_options %>

    <!-- === SUBSCRIPTION DETAILS === -->

    <div id="subscription-details-panel" style="<%= (@group.private?) ? '' : 'display:none;' %>">
    
      <h2>Subscription Details</h2>

      <p class="help-block">
        All plans come with a 14 day free trial.
        <a class="btn btn-link" href="/pricing" target="_blank">View Complete Pricing Details</a>
      </p>

      <%= f.input :subscription_plan, label: 'Subscription Plan', as: :select, 
        collection: SUBSCRIPTION_OPTIONS[@group.pricing_group] %>

    </div>

    <% unless @group.new_record? %>

      <!-- === EXTRA INFO === -->
      
      <h2>Extra information</h2>

      <%= f.input :location, label: 'Location', placeholder: 'Titusville, FL',
                  input_html: { class: 'input-xlarge' } %>

      <%= f.input :website, label: 'Website', placeholder: 'http://www.nasa.gov',
                  input_html: { class: 'input-xlarge' } %>

      <%= f.input :image_url, label: 'Group Image URL', 
                  placeholder: 'http://nasa.gov/logo.png',
                  input_html: { class: 'input-xlarge' } %>

      <% if @badge_list_admin %>
        <%= f.input :user_limit, label: '(ADMIN) User Limit', 
            placeholder: 'Private group allowed size',
            input_html: { class: 'input-mini' } %>
      <% end %>

      <!-- === GROUP OWNERSHIP === -->

      <h2>Transfer group ownership</h2>
      
      <%= f.input :new_owner_username, label: 'New owner', 
        placeholder: 'Enter Badge List username',
        hint: 'This will instantly and irreversably transfer ownership of this group to the ' \
        + 'user you specify (enter their Badge List username not their email). ' \
        + 'Badge List will not send them a notification so please be sure to ' \
        + 'notify the recipient and get their agreement beforehand.' %>

    <% end %>
  </div>  
  
  <div class="form-footer add-top-margin">
    <%= f.button :submit, class: 'btn btn-primary' %>
    <%= 
      if @group.new_record?
        link_to "Cancel", root_path, class: "btn"
      else 
        link_to "Cancel", @group, class: "btn"
      end
    %>
  </div>
<% end %>