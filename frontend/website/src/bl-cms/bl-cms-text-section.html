<!-- #=== POLYMER & SHIMS ===# -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- #=== BADGE LIST COMPONENTS ===# -->
<link rel="import" href="bl-cms-section-styles.html">
<link rel="import" href="bl-cms-background-pattern.html">
<link rel="import" href="bl-cms-section-mixin.html">
<link rel="import" href="bl-cms-section-title.html">
<link rel="import" href="bl-cms-section-buttons.html">
<link rel="import" href="bl-cms-section-footer.html">

<!-- #=== OTHER COMPONENTS ===# -->
<link rel="import" href="../../bower_components/marked-element/marked-element.html">

<!--
# Badge List CMS Section #

This renders a CMS section item.
-->
<dom-module id="bl-cms-text-section">
  <template>

    <style include="bl-cms-section-style-classes">
      
      /* === LAYOUT & BASE STYLES === */
        
        :host {
          display: block;
          font-size: 1rem; 
        }

      /* === ROW & CONTENT STYLES === */

        #rowInner {
          display: flex;
          flex-direction: column;
          align-items: center;

          margin: 0 auto;
          max-width: 1000px;
        }
        #row.leftAlign #rowInner, #row.rightAlign #rowInner {
          flex-direction: column;
          align-items: flex-start;
        }
        @media(min-width: 840px) {
          #row.leftAlign #rowInner, #row.rightAlign #rowInner {
            flex-direction: row;
            align-items: center;
          }
        }

          #image {
            margin: 0 0 1rem 0;
            padding: 0 0 1.5rem 0;
            flex: 1 1 50%;
            order: 1;

            z-index: 5;
          }
          #image.dropShadow img {
            filter: drop-shadow(4px 5px 1.7px rgba(0, 0, 0, 0.14));
            -webkit-filter: drop-shadow(4px 5px 1.7px rgba(0, 0, 0, 0.14)); 
            filter: drop-shadow(4px 5px 1.7px rgba(0, 0, 0, 0.14));
          }
          #image.clipToCircle img {
            border-radius: 100em;
          }
          #image.cardMode img {
            border-radius: 9px;
            @apply --bl-shadow-5;
          }
          @media(min-width: 840px) {
            #image {
              margin: 0 0 2rem 0;
              padding: 0 0 3rem 0;
            }
          }
          @media(min-width: 840px) {
            #row.leftAlign #image {
              margin: 0;
              padding: 0 3rem 0 0;
            }
            #row.rightAlign #image {
              margin: 0;
              padding: 0 0 0 3rem;
              order: 2;
            } 
          }
            #image img {
              max-width: 100%;
              max-height: 20rem;
            }

          #content {
            flex: 1 1 100%;
            order: 2;
            text-align: center;

            z-index: 5;
          }
          #row.imagePresent #content {
            flex: 1 1 50%;
          }
          #row.centerAlign #content {
            max-width: 80%;
          }
          #row.leftAlign #content {
            text-align: left;
          }
          #row.rightAlign #content {
            text-align: left; /* left aligned on mobile */
            order: 1;
          }
          @media(min-width: 480px) {
            #row.centerAlign #content {
              max-width: 70%;
            }
          }
          @media(min-width: 840px) {
            #row.centerAlign #content {
              max-width: 60%;
            }
            #row.rightAlign #content {
              text-align: right;
            }
          }
            #body {
              font-size: 1.1rem;
              line-height: 1.5em;
              margin-top: 2rem;
            }
            #row.hideHeader #body {
              margin-top: 0;
            }

          #title {
            margin-bottom: 0;
          }
        
          #row.leftAlign #buttons, #row.rightAlign #buttons {
            justify-content: flex-start;  
          }
          @media(min-width: 840px) {
            #row.rightAlign #buttons {
              justify-content: flex-end;
            }
          }

    </style>

    <div id="row" class$="[[textRowClass]]" style$="[[rowStyle]]">
      <bl-cms-background-pattern content="[[content]]"></bl-cms-background-pattern>

      <div id="rowInner">
      
        <div id="image" hidden="[[!has(content.fields.image)]]" class$="[[imageClass]]">
          <img src$="[[imageUrl(content.fields.image.fields.file.url, widthBreakpoint, '500\,500\,500\,500')]]">
        </div>
          
        <div id="content">
          <bl-cms-section-title id="title" content="[[content]]"></bl-cms-section-title>

          <div id="body" hidden="[[!has(content.fields.body)]]">
            <marked-element markdown="[[content.fields.body]]">
              <div slot="markdown-html"></div>
            </marked-element>
          </div>
          
          <bl-cms-section-buttons id="buttons" content="[[content]]"></bl-cms-section-buttons>
          
          <bl-cms-section-footer id="footer" content="[[content]]"></bl-cms-section-footer>

        </div>

      </div>
    </div>

  </template>

  <script>
    class BlCmsTextSection extends BlCmsSectionMixin(Polymer.Element) {
      
      static get is() { return 'bl-cms-text-section'; }

      static get properties() {
        return {

          /** Returns the class string for the primary row of the section. */
          textRowClass: {
            type: String,
            computed: 
              '_textRowClass(content.fields.styles, content.fields.textColor, content.fields.sectionAlignment, content.fields.image)',
          },

          /** Returns the class string for the image. */
          imageClass: {
            type: String,
            computed: '_imageClass(content.fields.imageStyles)',
          },

        }
      }

      // #=== PROPERTY COMPUTER METHODS ===#

      _textRowClass(styles, textColor, sectionAlignment, image) {
        return (styles ? styles : [])
          .concat(`${textColor}Text`)
          .concat(`${sectionAlignment}Align`)
          .concat(`image${image ? 'Present' : 'Missing'}`)
          .join(' ');
      }

      _imageClass(imageStyles) {
        return (imageStyles ? imageStyles : []).join(' ');
      }

    }

    window.customElements.define(BlCmsTextSection.is, BlCmsTextSection);
  </script>
</dom-module>