<!-- #=== POLYMER & SHIMS ===# -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- #=== STANDARD POLYMER COMPONENTS ===# -->
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-tooltip/paper-tooltip.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">

<!-- #=== BADGE LIST COMPONENTS ===# -->
<link rel="import" href="../bl-website/bl-website-component-mixin.html">
<link rel="import" href="../bl-styles/bl-styles.html">

<!--
# Badge List Header Nav Right #

Displays the current user dropdown menu or a link to sign in / register.

## Styling ##

The following custom properties and mixins are available for styling:

Custom property | Description | Default
----------------|-------------|----------
`--link-color` | Used for the text color of the signin icon. | `--bl-grey-700`
`--button-color` | Used for the text color of the signin icon. | `--bl-orange-600`
`--ghost-button-border-color` | Used for the border color of ghost buttons. | `rgba(255, 255, 255, 0.4)`
`--avatar-border-color` | Used for the border of the user avatar. | Same as link color or `--bl-grey-700`
`--avatar-background` | Used for the background of the user avatar. | Same as link color or `--bl-grey-700`
`--menu-text-color` | Used for the text color of the user dropdown menu. | `--bl-grey-700`
-->
<dom-module id="bl-header-nav-right">
  <template>

    <style include="bl-style-classes">

      /* === LAYOUT & BASE STYLES === */
        
        :host {
          position: absolute;
          top: 4px;
          right: 0;
          width: calc(100vw - 10rem);
          
          font-size: 1rem;
          padding: 0.5em 0.8em 0.5em 0;
          line-height: 1em;
          
          text-align: right;
        }

      /* === NAVBAR STYLES === */

        #navLinks {
          list-style: none;
          display: flex;
          flex-direction: row;
          justify-content: flex-end;
          align-items: center;

          padding: 0;
          margin: 0;
        }
          #navLinks > li {
            margin-left: 1rem;
          }
          #navLinks > li:first-of-type {
            margin-left: 0;
          }
            #navLinks > li > a {
              display: block;

              font-size: 0.9rem;
              line-height: 1em;
              padding: calc(0.45rem - 1px) 0.5rem;

              border-radius: 100em;
              border: 1px solid transparent;
              color: var(--link-color, var(--bl-grey-700));
              text-decoration: none;
            }
            #navLinks > li > a.button-link {
              padding-left: 1rem;
              padding-right: 1rem;
              background: var(--button-color, var(--bl-orange-600));
              color: white;
              border-color: rgba(255, 255, 255, 0.4);
            }
            #navLinks > li > a.ghost-button-link {
              padding-left: 1rem;
              padding-right: 1rem;
              border-color: var(--ghost-button-border-color, rgba(255, 255, 255, 0.4));
            }
              #navLinks > li > a > i.on-left {
                margin-right: 0.1rem;
              }
              #navLinks > li > a > i.on-right {
                margin-left: 0.1rem;
              }

              #menuButtonWrapper {
                border: 0.1em solid var(--avatar-border-color, var(--link-color, var(--bl-grey-400)));
                background: var(--avatar-background, var(--bl-grey-200));
                border-radius: 500px;
                overflow: hidden;
                width: 1.8em;
                height: 1.8em;
              }
                paper-menu-button {
                  padding: 0;
                  text-align: left;
                }
                  paper-icon-button.menu-button {
                    height: 2em; /* need to leave 0.2em for the border */
                    width: 2em; /* need to leave 0.2em for the border */
                    padding: 0;
                  }
                    paper-listbox {
                      width: 12em;
                    }
                      paper-item { padding: 0; }
                      paper-item.error { background-color: rgb(239,154,154); }
                        paper-item a, paper-item a:visited { 
                          padding: 0 1rem;
                          display: block;
                          line-height: 3em;
                          text-decoration: none;
                          color: var(--menu-text-color, var(--bl-grey-700));
                        }
                        paper-item a.toggle-on {
                          color: var(--bl-orange-900);
                        }
                        paper-item a.toggle-off {
                          color: var(--bl-grey-400);
                        }
                        paper-item.error a { color: white !important; }

          
    </style>

    <ul id="navLinks">
      <!-- #=== SITE LINKS ===# -->
      <li class="showAt840">
        <a href="/pricing">
          Pricing
        </a>
      </li>
      <li class="showAt840">
        <a href="/docs">
          Help Docs
        </a>
      </li>

      <!-- #=== VISITOR LINKS ===# -->
      <li class="first-of-section" hidden="[[has(currentUser.id)]]">
        <a href="/users/sign_in">
          <i class="icon-user on-left"></i>
          Login
        </a>
      </li>
      <li class="showAt480" hidden="[[has(currentUser.id)]]">
        <a href="#" class="ghost-button-link" on-tap="openIntercom">
          <i class="icon-bubble-text on-left"></i>
          Talk to us
        </a>
      </li>
      <li hidden="[[has(currentUser.id)]]">
        <a href="/users/sign_up" class="button-link">
          Sign up
          <i class="icon-pointer-right on-right"></i>
        </a>
      </li>
      
      <!-- #=== USER LINKS ===# -->
      <li class="first-of-section" hidden="[[!has(currentUser.id)]]">
        <a href="/home">
          <i class="icon-home-user on-left"></i>
          App Home
        </a>
      </li>
      <li hidden="[[!has(currentUser.id)]]">
        <div id="menuButtonWrapper">
          <paper-menu-button horizontal-align="right" no-overlap>
            <paper-icon-button class="menu-button" src="[[currentUser.avatar_image_medium_url]]" slot="dropdown-trigger">
            </paper-icon-button>

            <paper-listbox slot="dropdown-content">
              <paper-item hidden="[[!currentUser.email_inactive]]" class="error">
                <a href="/users/edit">
                  <i class="icon-warning"></i> Email blocked
                </a>
              </paper-item>
              <paper-item>
                <a href$="/u/[[currentUser.username_with_caps]]">
                  <i class="icon-shield-user"></i> Badge profile
                </a>
              </paper-item>
              <paper-item>
                <a href="/report_results">
                  <i class="icon-file-spreadsheet"></i> Run reports
                </a>
              </paper-item>    
              <paper-item>
                <a href="/users/edit">
                  <i class="icon-user-gear"></i> Manage account
                </a>
              </paper-item>
              <paper-item>
                <a href="/users/edit#upload-image">
                  <i class="icon-portrait"></i> Change image
                </a>
              </paper-item> 
              <paper-item hidden="[[!currentUser.admin]]">
                <a href="/a">
                  <i class="icon-wrench2"></i> Admin tools
                </a>
              </paper-item>
              <paper-item hidden="[[!currentUser.admin]]">
                <a href="#" hidden="[[!equal(cmsPreviewMode, 'on')]]" class="toggle-on" on-tap="toggleCmsPreviewMode">
                  <i class="icon-toggle-on"></i> CMS Preview is <strong>On</strong>
                </a>
                <a href="#" hidden="[[equal(cmsPreviewMode, 'on')]]" class="toggle-off" on-tap="toggleCmsPreviewMode">
                  <i class="icon-toggle-off"></i> CMS Preview is <strong>Off</strong>
                </a>
              </paper-item>
              <paper-item>
                <a href="/users/logout" class="signout" data-method="delete">
                  <i class="icon-exit"></i> Sign out
                </a>
              </paper-item>
            </paper-listbox>
          </paper-menu-button>
        </div>
      </li>
    </ul>

  </template>

  <script>
    class BlHeaderNavRight extends BlWebsiteComponentMixin(Polymer.Element) {
      
      static get is() { return 'bl-header-nav-right'; }

      static get properties() {
        return {};
      }

      // #=== PUBLIC ACTION METHODS ===#

      toggleCmsPreviewMode() {
        this.cmsPreviewMode = (this.cmsPreviewMode == 'on') ? 'off' : 'on';
        sessionStorage.setItem('cmsPreviewMode', this.cmsPreviewMode);
        window.location.reload();
      }

      openIntercom() {
        Intercom('show');
      }

    }

    window.customElements.define(BlHeaderNavRight.is, BlHeaderNavRight);
  </script>
</dom-module>
