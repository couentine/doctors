<!--
# Badge List App Container #
  
This is the primary container for the all internal app pages. It contains the app layout elements.
There will only be one of these on the page. 

All app components should use `BlAppComponentMixin`. That provides an `appContainer` property which points at the container.
The mixin also provides various actions for interacting with the container.
-->
<script>

  BlAppComponentMixin = function(superClass) {
    return class extends superClass {

      static get properties() {
        return {
          app: Object,
          currentUser: Object
        };
      }

      // #=== COMPONENT METHODS ===#
      
      addToast(text, type, autoCloseAfter) {
        // Displays new toast item in the app toast container
        // Leave type or autoCloseAfter blank to use the default
        this.app.$.toastContainer.addToast(text, type, autoCloseAfter);
      }

      openAlertDialog(options) {
        // Shows the standard alert dialog. The following options should be included:
        // - color = ['orange', 'green', 'blue', 'grey', 'red']
        // - title = The title of the dialog
        // - body = (Optional) The body text
        // - confirm = { text: 'Accept', action: function(){} } >> leave out property to hide button
        // - dismiss = { text: 'Cancel', action: function(){} } >> leave out property to hide button

        // First set the basic properties
        this.app.$.alertDialog.noCancelOnEscKey = false; // restore this (overridden from modal default)
        this.app.setDialogColor(options.color);
        this.app.$.alertDialogTitle.innerHTML = options.title;
        if (options.body) {
          this.app.$.alertDialogBody.innerHTML = options.body;
          this.app.$.alertDialogBody.hidden = false;
        } else {
          this.app.$.alertDialogBody.innerHTML = '';
          this.app.$.alertDialogBody.hidden = true;
        }

        // Then set up the buttons
        if (options.confirm) {
          this.app.$.alertDialogConfirmText.innerHTML = options.confirm.text;
          this.app.$.alertDialogConfirm.hidden = false;
          this.app.dialogConfirmFunction = options.confirm.action;
        } else {
          this.app.$.alertDialogConfirmText.innerHTML = '';
          this.app.$.alertDialogConfirm.hidden = true;
          this.app.dialogConfirmFunction = null;
        }
        if (options.dismiss) {
          this.app.$.alertDialogDismissText.innerHTML = options.dismiss.text;
          this.app.$.alertDialogDismiss.hidden = false;
          this.app.dialogDismissFunction = options.dismiss.action;
        } else {
          this.app.$.alertDialogDismissText.innerHTML = '';
          this.app.$.alertDialogDismiss.hidden = true;
          this.app.dialogDismissFunction = null;
        }

        this.app.$.alertDialog.open();
      }

      openPollerDialog(pollerId, options) {
        // Shows the standard poller dialog. The following options should be included:
        // - color = ['orange', 'green', 'blue', 'grey', 'red']
        // - title = The title of the dialog
        // - confirm = { text: 'Accept', action: function(){} } >> leave out property to hide button
        // - dismiss = { text: 'Cancel', action: function(){} } >> leave out property to hide button
        // - showButtonsOnLoad = (Default = false) Unless set to true, 
        //                                         the buttons are hidden until poller completes

        // First set the basic properties
        this.app.setDialogColor(options.color);
        this.app.$.pollerDialogTitle.innerHTML = options.title;

        // Then set up the buttons
        if (options.confirm) {
          this.app.$.pollerDialogConfirmText.innerHTML = options.confirm.text;
          this.app.$.pollerDialogConfirm.hidden = false;
          this.app.dialogConfirmFunction = options.confirm.action;
        } else {
          this.app.$.pollerDialogConfirmText.innerHTML = '';
          this.app.$.pollerDialogConfirm.hidden = true;
          this.app.dialogConfirmFunction = null;
        }
        if (options.dismiss) {
          this.app.$.pollerDialogDismissText.innerHTML = options.dismiss.text;
          this.app.$.pollerDialogDismiss.hidden = false;
          this.app.dialogDismissFunction = options.dismiss.action;
        } else {
          this.app.$.pollerDialogDismissText.innerHTML = '';
          this.app.$.pollerDialogDismiss.hidden = true;
          this.app.dialogDismissFunction = null;
        }
        if (options.showButtonsOnLoad) this.app.$.pollerDialogButtons.classList.remove('collapsed');
        else this.app.$.pollerDialogButtons.classList.add('collapsed');

        this.app.$.pollerDialogPoller.pollerId = pollerId; // This starts the poller query
        this.app.$.pollerDialog.open();
      }

      openWaitingDialog(options) {
        // Shows the standard waiting dialog. The following options should be included:
        // - color = ['orange', 'green', 'blue', 'grey', 'red']
        // - title = The title of the dialog

        this.app.setDialogColor(options.color);
        this.app.$.waitingDialogTitle.innerHTML = (options.title) ? options.title : 'Waiting...';
        this.app.$.waitingDialog.open();
      }

      closeWaitingDialog() {
        this.app.$.waitingDialog.close();
      }

      // #=== LIFECYCLE EVENTS ===#

      connectedCallback() {
        if (super.connectedCallback) super.connectedCallback();
        
        this.app = document.querySelector('bl-app');
        this.currentUser = this.app.currentUser;
      }

    }
  }

</script>