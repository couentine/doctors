<link rel="import" href="../../../bower_components/polymer/lib/elements/dom-if.html">
<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/shadycss/apply-shim.html">
<link rel="stylesheet" href="../../../bower_components/components-font-awesome/css/font-awesome.min.css">

<link rel="import" href="../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../../../bower_components/paper-menu-button/paper-menu-button.html">

<link rel="import" href="../bl-app-component-mixin.html">

<dom-module id="bl-app-navbar-right">
  <template>

    <style>

      /* === LAYOUT & BASE STYLES === */
        
        :host {
          display: block;
          justify-content: space-between;
          font-size: 1rem;
          text-align: right;
          position: absolute;
          top: 4px;
          right: 0;
          width: 2em;
          padding: 0.5em 0.8em;
          line-height: 1em;
        }

      /* === NAVBAR STYLES === */
        
        a { text-decoration: none; }
          a i.fa { margin-right: 0.5em; }

        a#sign-in-link.true { /* true = this.whiteText */
          color: white;
        }
          a#sign-in-link i.fa { font-size: 2em; }

        paper-menu-button {
          padding: 0;
          text-align: left;
        }
          .dropdown-trigger { 
            display: inline-block; 
            cursor: pointer;
          }
            .dropdown-trigger > img { 
              height: 1.8em; /* total of height + (2 * border) = 2em */
              border: 0.1em solid #BDBDBD;
              border-radius: 500px;
              display: inline-block;
            }
            .dropdown-trigger > img.true {  /* true = this.whiteText */
              border-color: white; 
            }
        
          paper-menu-button .dropdown-content {
            z-index: 110;
            width: 14em;
          }
            paper-item { 
              color: #616161; 
              padding: 0;
            }
            paper-item.error { background-color: rgb(239,154,154); }
              paper-item a {
                padding: 0 16px;
                flex: 1 1 auto;
                line-height: 3em;
              }
              paper-item.error a { color: white !important; }
          
    </style>
    
    <!-- #=== LOGGED OUT NAV ===# -->

    <template is="dom-if" if="[[!isLoggedIn]]">
      <a href="/users/sign_in" id="sign-in-link" class$="[[whiteText]]" title="Sign in or register">
        <i class="fa fa-sign-in"></i>
      </a>
      <paper-tooltip for="sign-in-link" animation-delay="50" fit-to-visible-bounds offset="5">
        Sign in or register
      </paper-tooltip>
    </template>

    <!-- #=== LOGGED IN NAV ===# -->

    <template is="dom-if" if="[[isLoggedIn]]">
      <paper-menu-button class="current-user" horizontal-align="right" no-overlap>
        <div class="dropdown-trigger">
          <img src$="[[currentUser.avatar_image_medium_url]]" class$="[[whiteText]]">
        </div>
        <paper-menu class="dropdown-content">
          <paper-item hidden="[[!currentUser.email_inactive]]" class="error">
            <a href="/users/edit">
              <i class="fa fa-fw fa-exclamation-triangle"></i> Email blocked
            </a>
          </paper-item>
          <paper-item>
            <a href$="[[currentUserProfile]]">
              <i class="fa fa-fw fa-shield"></i> Badge profile
            </a>
          </paper-item>
          <paper-item>
            <a href="/report_results">
              <i class="fa fa-fw fa-table"></i> Run reports
            </a>
          </paper-item>    
          <paper-item>
            <a href="/users/edit">
              <i class="fa fa-fw fa-user"></i> Manage account
            </a>
          </paper-item>
          <paper-item>
            <a href="/users/edit#upload-image">
              <i class="fa fa-fw fa-picture-o"></i> Change image
            </a>
          </paper-item> 
          <paper-item hidden="[[!currentUser.admin]]">
            <a href="/a">
              <i class="fa fa-fw fa-cogs"></i> Admin tools
            </a>
          </paper-item>
          <paper-item>
            <a href="/users/sign_out" class="signout" data-method="delete">
              <i class="fa fa-fw fa-remove"></i> Sign out
            </a>
          </paper-item>
        </paper-menu>
      </paper-menu-button>
    </template>

  </template>

  <script>
    class BlAppNavbarRight extends BlAppComponentMixin(Polymer.Element) {
      static get is() { return 'bl-app-navbar-right'; }

      static get properties() {
        return {
          currentUser: { type: Object, observer: '_currentUserChanged' },
          whiteText: { type: Boolean, value: false },
          isLoggedIn: { type: String, value: false, readOnly: true },
          currentUserProfile: { type: String, computed: "_currentUserProfile(currentUser)" }
        };
      }

      // #=== LISTENER & OBSERVER METHODS ===#

      _currentUserChanged(newValue, oldValue) {
        this._setIsLoggedIn(newValue && newValue.username_with_caps);
      }

      // #=== PROPERTY COMPUTER METHODS ===#

      _currentUserProfile(currentUser) {
        return "/u/" + currentUser.username_with_caps;
      }

    }

    window.customElements.define(BlAppNavbarRight.is, BlAppNavbarRight);
  </script>
</dom-module>
