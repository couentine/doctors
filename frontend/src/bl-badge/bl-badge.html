<!-- #=== POLYMER & SHIMS ===# -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- #=== STANDARD POLYMER COMPONENTS ===# -->
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">

<!-- #=== BADGE LIST COMPONENTS ===# -->
<link rel="import" href="../bl-styles/bl-styles.html">

<!--
# Badge Card #

This displays a standard badge card.
-->
<dom-module id="bl-badge">
  <template>

    <style include="bl-style-classes">
      
      /* === LAYOUT & BASE STYLES === */
        
        :host {
          display: flex;
          flex-direction: column;
          position: relative;
          z-index: 0;
        }

      /* === COMPONENT STYLES === */

        paper-ripple { z-index: 50; }

        .image {
          text-align: center;
          flex: none;
          z-index: 2;
        }
          img,
          .image i {
            filter: drop-shadow(2px 2px 1px rgba(0,0,0,0.2));
            -webkit-filter: drop-shadow(2px 2px 1px rgba(0,0,0,0.2)); 

            -webkit-transition: all 0.2s linear;
            -o-transition: all 0.2s linear;
            -moz-transition: all 0.2s linear;
            -ms-transition: all 0.2s linear;
            -kthtml-transition: all 0.2s linear;
            transition: all 0.2s linear;
          }
          :host(:hover) img,
          :host(:hover) .image i { 
            filter: drop-shadow(4px 4px 1px rgba(0,0,0,0.2));
            -webkit-filter: drop-shadow(4px 4px 1px rgba(0,0,0,0.2)); 
          }
            img {
              display: inline-block;
              max-width: 7em; max-height: 7em;
            }
          .image i {
            font-size: 7em;
            color: rgb(97,97,97);
            line-height: 0.8em;
            border-radius: 500px;
            background-color: white;
            margin: 0;
          }
        .label {
          flex: none;
          z-index: 1;
          margin-top: -1em;
          position: relative;
          text-align: center;
        }
          paper-icon-button {
            position: absolute;
            bottom: -1.1em; right: -1.1em;

            --paper-icon-button: {
              width: 2.4em;
              color: #616161;
              transition: color 0.3s;
            };
            --paper-icon-button-hover: {
              color: #D32F2F;
            };
          }
          .label-title {
            display: inline-block;
            background-color: rgb(250,250,250);
            padding: 0.8em;
            max-width: 10em;
            border: 1px solid rgba(224,224,224, 0.7);
            border-radius: 0.4em;
            font-family: 'Lato', 'Open Sans', Verdana, Arial !important;
            @apply(--bl-badge-title);
          }
            h2 {
              display: block;
              margin: 0;
              font-size: 1.1em;
              font-weight: 600;
              color: rgb(97,97,97);
              text-align: center;
            }
            ul.metric-list {
              list-style: none;
              padding: 0;
              margin: 1em 0 0 0;
              color: rgb(97,97,97);
              font-size: 0.8em;
              display: block;
            } 
              ul.metric-list li {
                display: inline-block;
                margin: 0 0.5em 0 0;
              }
              ul.metric-list i {
                color: rgb(249,168,37);
                margin: 0 0.15em 0 0;
              }

    </style>

    <paper-ripple></paper-ripple>

    <div class="image">
      <template is="dom-if" if="[[hasBadge]]">
        <img src$="[[badge.image_medium_url]]">
      </template>
      
      <template is="dom-if" if="[[!hasBadge]]">
        <i class$="[[blankBadgeIconClass]]"></i>
      </template>
    </div>
    <div class="label">
      <div class="label-title">
        <h2>[[badgeName]]</h2>
        <ul class="metric-list" hidden="[[!showMetricList]]">
          <li hidden$="[[!showExpertCount]]" class="expert-count">
            <i class="icon-shield-user"></i>
            <span class="metric">[[badge.expert_count]]</span>
          </li>
          <li hidden="[[!showRequestCount]]" class="request-count">
            <i class="icon-flag"></i>
            <span class="metric">[[badge.validation_request_count]]</span>
          </li>
        </ul>
      </div>

      <template is="dom-if" if="[[showRemove]]">
        <paper-icon-button icon="cancel" on-tap="removeBadge"></paper-icon-button>
      </template>
    </div>

  </template>

  <script>
    class BlBadge extends Polymer.Element {
      
      static get is() { return 'bl-badge'; }

      static get properties() {
        return {
          
          badge: {
            type: Object,
            observer: "_badgeObserver"
          },

          blankBadgeText: {
            type: String,
            value: "No Badge"
          },

          blankBadgeIconClass: {
            type: String,
            value: "icon-shield"
          },

          options: Object, // valid keys = showExpertCount, showRequestCount

          showExpertCount: {
            type: Boolean,
            value: false
          },
          
          showRequestCount: {
            type: Boolean,
            value: false
          },
          
          displayMode: String, // optional = ['admin']

          showMetricList: {
            type: Boolean, 
            value: false, 
            computed: "_showMetricList(showExpertCount, showRequestCount)"
          },

          showRemove: {
            type: Boolean,
            computed: '_showRemove(displayMode)'
          },

          badgeName: String,

          hasBadge: Boolean

        }
      }

      // #=== LIFECYCLE EVENTS ===#

      ready() {
        if (super.ready) super.ready();
        
        this._badgeObserver();
      }

      // #=== LISTENER & OBSERVER METHODS ===#

      _badgeObserver() {
        if (this.badge) this.hasBadge = true;
        else this.hasBadge = false;

        if (this.badge && this.badge.name) this.badgeName = this.badge.name;
        else this.badgeName = this.blankBadgeText;
      }

      // #=== PROPERTY COMPUTER METHODS ===#

      _showMetricList(showExpertCount, showRequestCount) {
        return showExpertCount || showRequestCount;
      }

      _showRemove(displayMode) {
        return displayMode == 'admin';
      }

    }

    window.customElements.define(BlBadge.is, BlBadge);
  </script>
</dom-module>
