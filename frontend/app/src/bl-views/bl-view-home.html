<!-- #=== POLYMER & SHIMS ===# -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- #=== STANDARD POLYMER COMPONENTS ===# -->
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<!-- #=== BADGE LIST COMPONENTS ===# -->
<link rel="import" href="../bl-backend/bl-backend-list-load-more.html">
<link rel="import" href="../bl-backend/bl-backend-list-placeholder.html">
<link rel="import" href="../bl-backend/bl-backend-list.html">
<link rel="import" href="../bl-badge/bl-badge.html">
<link rel="import" href="../bl-group/bl-group.html">
<link rel="import" href="../bl-styles/bl-styles.html">
<link rel="import" href="../bl-text/bl-label.html">
<link rel="import" href="../bl-text/bl-subheader.html">
<link rel="import" href="../bl-skeletons/bl-text-skeleton.html">
<link rel="import" href="../bl-skeletons/bl-image-skeleton.html">
<link rel="import" href="../bl-user/bl-user-badge-count.html">
<link rel="import" href="bl-header-nav-left.html">
<link rel="import" href="bl-header-nav-right.html">
<link rel="import" href="bl-header-panel.html">
<link rel="import" href="bl-view-mixin.html">

<!--
# Badge List Home View #

The home page for logged in users.
-->
<dom-module id="bl-view-home">
  <template>

    <style include="bl-style-classes">
      
      /* === LAYOUT & BASE STYLES === */
        
        :host {
          display: none;
        }
        :host([status=active]) {
          display: block;
        }

      /* === HEADER PANEL STYLES === */

        bl-header-panel {
          background: white;
        }
          #expandedBackground {
            border-top: 4px solid var(--bl-orange-600);
            background: white;
          }
          #condensedBackground {
            border-top: 4px solid var(--bl-orange-600);
            background: white;
          }
          #headerBottomLinks {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: row;
            justify-content: flex-end;

            @apply --bl-font-subhead;
          }
            #headerBottomLinks>li {
              flex: 0 0 auto;
              margin: 0.5em;
            }
              #headerBottomLinks>li>a, #headerBottomLinks>li>a:visited {
                color: var(--bl-grey-700);
                text-decoration: none;
              }
          #content {
            color: var(--bl-grey-800);
          }

      /* === PAGE HEADER STYLES === */

        #pageHeader {
          line-height: 1.3em;
          padding-top: 1em;
          background-color: var(--bl-grey-200);
          border-top: 1px solid var(--bl-grey-400);
          border-bottom: 1px solid var(--bl-grey-400);
          color: var(--bl-grey-700);
          
          display: flex;
          justify-content: center;
          padding: 1em;
        }
          #imagePanel { 
            display: inline-block;
            vertical-align: top;
            margin: 0 1em 0 0;
            position: relative;
            width: 70px; height: 70px;
            flex: none;
          }
          @media (min-width: 480px) { #imagePanel { width: 120px; height: 120px; } }
          @media (min-width: 840px) { #imagePanel { width: 150px; height: 150px; } }
            #imagePanel bl-image-skeleton {
              display: block;
              height: 100%;
              width: 100%;
              --skeleton-color: var(--bl-grey-300);
              --skeleton-border: 2px solid rgb(250,250,250);
            }
            #imagePanel img { 
              display: block;
              width: 100%;
              height: 100%;
            }

            #imagePanel a, #imagePanel a:visited {
              position: absolute;
              top: 0; right: 0; bottom: 0; left: 0;

              display: flex;
              justify-content: center;
              align-items: center;

              color: white;
              opacity: 0;
              text-align: center;
              text-decoration: none;
              font-size: 3em;
              border-radius: 100%;
              filter: drop-shadow(4px 4px 1px rgba(0,0,0,0.2));
              -webkit-filter: drop-shadow(4px 4px 1px rgba(0,0,0,0.2)); 
              transition: opacity 0.3s;
            }
              #imagePanel a:hover, #imagePanel a:hover:focus {
                opacity: 0.65;
              }
              @media (min-width: 480px) { #imagePanel a { font-size: 4.5em; } }
              @media (min-width: 840px) { #imagePanel a { font-size: 5rem; } }

          #textPanel { 
            display: inline-block;
            vertical-align: top;
            margin-right: 1em;
            flex: 1 1 auto;
            max-width: 27em;
          }
            #textPanel h1 {
              font-size: 2em;
              line-height: 1.3em;
              margin: 0;
            }
              #textPanel h1 bl-text-skeleton {
                --skeleton-color: var(--bl-grey-300);
                --skeleton-line-width: 90%;
                --first-line-margin-top: 0.6rem;
              }
            #textPanel .subtitle { 
              font-size: 1.8em;
              line-height: 1.3em;
              margin: 0;
            }
              #textPanel .subtitle bl-text-skeleton {
                --skeleton-color: var(--bl-grey-300);
                --skeleton-line-width: 70%;
                margin: 1rem 0 0.5rem 0;
              }
            #textPanel a.button { 
              margin-top: 0.5em;
            }
            #textPanel bl-label { 
              font-size: 1em;
              margin: 0.5em 0; 
            }
          #badgeCountPanel { 
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            flex: 0 0 auto;
          }

        /* === BADGE PANEL === */

          #badgePanel {
            display: flex;
            flex-wrap: wrap;
          }
            #badgePanel a.item {
              margin: 1em;
              flex: 1 1 10em;
              text-decoration: none;
            }
            #badgePanel a.placeholder-link, #badgePanel a.placeholder-link:visited {
              color: inherit;
            }

        /* === GROUP PANEL === */

          #groupPanel {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
          }
            #groupPanel bl-backend-list-placeholder p {
              max-width: 30em;
              margin: 1em auto;
            }
            #groupPanel a.item {
              margin: 1em;
              flex: 1 1 10em;
              text-decoration: none;
            }
            #groupPanel a.placeholder-link, #groupPanel a.placeholder-link:visited {
              color: inherit;
            }
              #groupPanel bl-group {
                margin: 0 auto;
              }


    </style>

    <!-- #=== BACKEND LINKS ===# -->

    <bl-backend-list id="badgeList" target="{{badges}}" model="badge" parent-view-status="[[status]]"
      parameters='{"filter[status]": "seeker"}'></bl-backend-list>
    <bl-backend-list id="groupList" target="{{groups}}" model="group" parent-view-status="[[status]]"></bl-backend-list>

    <!-- #=== HEADER PANEL ===# -->

    <bl-header-panel id="headerPanel" expanded-height="9" condensed-height="6" current-user="[[currentUser]]">
      <div id="expandedBackground" slot="expandedBackground">&nbsp;</div>
      <div id="condensedBackground" slot="condensedBackground">&nbsp;</div>

      <ul id="headerBottomLinks" slot="headerBottom">
        <li>
          <a href$="[[appPath('link.community', app.initialized)]]">
            <i class="icon-group-circle"></i> Community
          </a>
        </li>
        <li>
          <a href$="[[appPath('docs.index', app.initialized)]]">
            <i class="icon-question-circle"></i> Help Docs
          </a>
        </li>
        <li>
          <a href$="[[appPath('website.index', app.initialized)]]">
            <i class="icon-earth"></i> Website
          </a>
        </li>
      </ul>

      <bl-header-nav-left slot="leftNav">
        <img src$="[[app.manifest.assets.brand.shieldPng]]">
      </bl-header-nav-left>

      <div id="content" slot="content">
        
        <!-- #=== PAGE HEADER ===# -->

        <div id="pageHeader">
          <div id="imagePanel">
            <bl-image-skeleton id="imageSkeleton" rounded loaded="[[currentUser.backend.status.hasContent]]" 
                spinner="[[currentUser.backend.status.isLoading]]" error="[[currentUser.backend.status.isError]]">
              <img src$="[[currentUser.attributes.image_medium_url]]">
              <a href$="[[appPath('currentUser.edit', app.initialized)]]#upload-image">
                <i class="icon-pencil"></i>
              </a>
            </bl-image-skeleton>
          </div>
          
          <div id="textPanel">
            <h1>
              <bl-text-skeleton loaded="[[currentUser.backend.status.hasContent]]">
                [[currentUser.attributes.name]]
              </bl-text-skeleton>
            </h1>
            
            <div class="subtitle" hidden="[[currentUser.backend.status.hasContent]]">
              <bl-text-skeleton></bl-text-skeleton>
            </div>
              
            <!-- #=== EMAIL VERIFICATION NEEDED ===# -->
            <bl-label class="orange" 
                hidden="[[!and(currentUser.backend.status.hasContent, currentUser.attributes.email_verification_needed)]]">
              <i class="icon-envelope-warning"></i>
              Your email address needs verification
            </bl-label>

            <!-- #=== EMAIL VERIFICATION NOT NEEDED ===# -->
            <div class="subtitle" hidden="[[currentUser.attributes.email_verification_needed]]">
              [[currentUser.attributes.username]]
            </div>

            <a class="button" href$="[[appPath('currentUser.edit', app.initialized)]]" tabindex="-1">
              <paper-button raised>Manage Account</paper-button>
            </a>
          </div>
          
          <div id="badgeCountPanel">
            <bl-user-badge-count id="badgeCount" user="[[currentUser]]"></bl-user-badge-count>
          </div>
        </div>

        <!-- #=== BADGES ===# -->

        <bl-subheader>
          <span slot="title">Badges in progress</span>
        </bl-subheader>

        <div id="badgePanel" class="page-content-spacing">
          <template is="dom-repeat" items="[[badges.items]]" id="badgeRepeat" as="badge">
            <a href$="[[badge.links.self_web]]" class="item">
              <bl-badge badge="[[badge]]"></bl-badge>
            </a>
          </template>
          <bl-backend-list-placeholder target-list="[[badges]]" icon-class="icon-shield">
            <p>
              <strong>Want to earn a badge?</strong>
            </p>
            <p>
              Join the <a class="placeholder-link" href$="[[appPath('link.community', app.initialized)]]">Badge List Community</a>!
            </p>
          </bl-backend-list-placeholder>
        </div>
        <bl-backend-list-load-more target-list="[[badges]]" color="orange"></bl-backend-list-load-more>

        <!-- #=== GROUPS ===# -->

        <bl-subheader>
          <span slot="title">Your groups</span>
          <div slot="buttons">
            <a href$="[[appPath('group.new', app.initialized)]]" class="button">
              <paper-button class="light-blue" raised>
                <i class="icon-plus"></i> New Group
              </paper-button>
            </a>
          </div>
        </bl-subheader>

        <div id="groupPanel" class="page-content-spacing">
          <template is="dom-repeat" items="[[groups.items]]" id="groupRepeat" as="group">
            <a href$="[[group.links.self_web]]" class="item">
              <bl-group group="[[group]]"></bl-group>
            </a>
          </template>
          <bl-backend-list-placeholder target-list="[[groups]]" icon-class="icon-group">
            <p>
              <strong>Looking for a specific group?</strong>
            </p>
            <p>
              Ask your group admin for the group's URL.
            </p>
            <p>
              <strong>Do you want to start issuing badges yourself?</strong>
            </p>
            <p>
              Click the blue "New Group" button to create your first group! 
              We've got a <a href$="[[appPath('link.tutorialVideo', app.initialized)]]" target="_blank">2 minute video tutorial</a>
              to help you get started.
            </p>
          </bl-backend-list-placeholder>
        </div>
        <bl-backend-list-load-more target-list="[[groups]]" color="light-blue"></bl-backend-list-load-more>

      </div>
    </bl-header-panel>

  </template>

  <script>
    class BlViewHome extends BlViewMixin(Polymer.Element) {

      static get is() { return 'bl-view-home'; }

      static get properties() {
        return {
          
          /** Displays badges in progress. */
          badges: Object,
            
          /** Displays my groups. */
          groups: Object

        }
      }

    }

    window.customElements.define(BlViewHome.is, BlViewHome);
  </script>
</dom-module>