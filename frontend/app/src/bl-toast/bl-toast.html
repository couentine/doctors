<!-- #=== POLYMER & SHIMS ===# -->
<link rel="import" href="../../bower_components/polymer/polymer.html">

<!-- #=== BADGE LIST COMPONENTS ===# -->
<link rel="import" href="../bl-text/bl-html.html">
<link rel="import" href="../bl-styles/bl-styles.html">

<!--
# Badge List Toast #

This is added to the bl-toast-container programmatically by calling the `addToast` method in `bl-app`.
-->
<dom-module id="bl-toast">
  <template>

    <style include="bl-style-classes">
      
      /* === LAYOUT & BASE STYLES === */
        
        :host {
          display: block;
          text-align: center;

          transition: 0.5s all;
          opacity: 1;
        }
        :host(.closing) {
          opacity: 0;
        }
        :host(.closed) {
          display: none;
        }
        @media (min-width: 840px) {
          :host {
            text-align: left;
          }
        }

      /* === COMPONENT STYLES === */

        #container {
          position: relative;
          display: inline-flex;
          align-items: center;
          text-align: left;
          
          margin: 0.5rem auto;
          padding: 0 1.2rem;
          
          background: var(--bl-grey-900);
          opacity: 0.97;
          color: var(--bl-grey-50);
          border: 1px solid var(--bl-grey-700);
          border-radius: 3px;

          @apply --bl-shadow-5;
        }
        @media (min-width: 840px) {
          #container {
            margin: 0.5rem 0;
          }
        }

          .inner {
            flex: 1 1 auto;
            padding: 1rem 0;
            line-height: 1.2em;
          }

          .action {
            flex: 0 0 auto;
            margin: 0.375rem -0.75rem 0.375rem 0.5rem;
          }
          .action paper-button {
            color: var(--bl-orange-700);
          }
        
    </style>

    <div id="container">
      <div class="inner">
        <bl-html value="[[text]]"></bl-html>
      </div>

      <div class="action" hidden="[[!hasAction]]">
        <paper-button on-tap="doAction" class="transparent borderless narrow">[[actionText]]</paper-button>
      </div>
    </div>

  </template>

  <script>
    class BlToast extends Polymer.Element {
      
      static get is() { return 'bl-toast'; }

      static get properties() {
        return {
          
          /** Required. The text displayed in the toast. */
          text: String,

          /** Optional, controls the color of the toast. Possible values include 'notice', error', 'warning' and 'success'. */
          type: String,

          /** Set this (along with `actionFunction` in order to show the action button. */
          actionText: String,

          /** Set this (along with `actionText` in order to show the action button. */
          actionFunction: Object,

          hasAction: {
            type: Boolean,
            computed: '_hasAction(actionText, actionFunction)',
          },

          /**
           * In milliseconds, set to 0 to disable autoclose. If so, then the toast must be manually dismissed by the consuming code,
           * since there is no dismiss button in the UI.
           */
          duration: {
            type: Number,
            value: 7000,
          }

        }
      }

      // #=== PUBLIC ACTION METHODS ===#

      doAction() {
        if (this.actionFunction) {
          this.closeToast();
          this.actionFunction();
        }
      }

      // #=== LIFECYCLE EVENTS ===#

      ready() {
        if (super.ready) super.ready();
        
        if (this.duration > 0) {
          setTimeout(function() {
            this.closeToast() 
          }.bind(this), this.duration);
        }
      }

      // #=== LISTENER & OBSERVER METHODS ===#

      closeToast() {
        this.classList.add('closing');
        setTimeout(function() {
          this.classList.add('closed');
          this.classList.remove('closing');
        }.bind(this), 500)
      }

      // #=== PROPERTY COMPUTER METHODS ===#

      _hasAction(actionText, actionFunction) {
        return actionText && actionFunction;
      }

    }

    window.customElements.define(BlToast.is, BlToast);
  </script>
</dom-module>
